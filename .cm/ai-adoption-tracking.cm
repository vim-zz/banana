# -*- mode: yaml -*-
# This CM automation tracks AI tool adoption in your repository
# Based on: https://linearb.helpdocs.io/article/n8q4ydqmkd-ai-insights
#
# Adoption Types:
# - Rules File: AI tool configuration file added/modified
# - Co-author: AI tool contributed as co-author in commits
# - PR Author: AI tool or bot created the PR

manifest:
  version: 1.0

# Custom expressions for AI tool detection
config:
  # Rule file patterns for each AI tool
  has_aider_rules: {{ files | match(regex=r/(^|.*\/).aider.conf.yml$/) | some }}
  has_amazonq_rules: {{ files | match(regex=r/^\.amazonq\/rules\/[^\/]+\.md$/) | some }}
  has_augmentcode_rules: {{ files | match(regex=r/^\.augment\/rules\/[^\/]+\.md$/) | some }}
  has_claude_rules: {{ files | match(regex=r/(^|.*\/)CLAUDE\.md$/) | some }}
  has_cursor_rules: {{ files | match(regex=r/(^|.*\/)\.cursorrules$|^\.cursor\/rules\/[^\/]+\.md$/) | some }}
  has_customtool_rules: {{ files | match(regex=r/(^|.*\/)\.customtool$|^\.custom\/rules\/[^\/]+\.rules$/) | some }}
  has_firebase_rules: {{ files | match(regex=r/(^|.*\/).idx\/airules.md$/) | some }}
  has_gemini_rules: {{ files | match(regex=r/(^|.*\/)GEMINI\.md$/) | some }}
  has_github_copilot_rules: {{ files | match(regex=r/^\.github\/copilot-instructions\.md$|^\.github\/[^\/]+-instructions\.md$/) | some }}
  has_goose_rules: {{ files | match(regex=r/(^|.*\/)\.goosehints$/) | some }}
  has_jetbrains_junie_rules: {{ files | match(regex=r/^\.junie\/[^\/]+\.md$/) | some }}
  has_kilocode_rules: {{ files | match(regex=r/^\.kilocode\/rules\/[^\/]+\.md$/) | some }}
  has_kiro_rules: {{ files | match(regex=r/^\.kiro\/steering\/[^\/]+\.md$/) | some }}
  has_openai_rules: {{ files | match(regex=r/(^|.*\/)AGENT\.md$|(^|.*\/)AGENTS\.md$/) | some }}
  has_openhands_rules: {{ files | match(regex=r/^\.openhands\/microagents\/[^\/]+\.md$/) | some }}
  has_warp_rules: {{ files | match(regex=r/(^|.*\/)WARP\.md$/) | some }}
  has_windsurf_rules: {{ files | match(regex=r/(^|.*\/)\.windsurfrules$/) | some }}
  has_zed_rules: {{ files | match(regex=r/(^|.*\/)\.rules$/) | some }}

  # Co-author detection patterns (check commit messages)
  has_aider_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*aider/i) | some }}
  has_aikido_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*aikido-/i) | some }}
  has_amazonq_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*amazon-q-developer/i) | some }}
  has_atlassian_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*code reviewer/i) | some }}
  has_bito_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*(^bito-|bito agent|bito PR agent|bitoagent)/i) | some }}
  has_claude_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*(^claude$|claude ai|claude ai assistant|claude code|claude github action|claude\[bot\])/i) | some }}
  has_codeant_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*codeant/i) | some }}
  has_codegen_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*codegen-sh/i) | some }}
  has_coderabbit_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*coderabbit/i) | some }}
  has_codota_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*codota/i) | some }}
  has_cubic_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*cubic-dev-ai/i) | some }}
  has_cursor_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*(-cursor|^cursor)/i) | some }}
  has_devin_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*(devin ai|devin-ai)/i) | some }}
  has_ellipsis_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*ellipsis/i) | some }}
  has_factory_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*(factory-ai|factory\.ai)/i) | some }}
  has_fine_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*(^fine-agent|^fine-ai)/i) | some }}
  has_gemini_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*(^gemini$|^gemini-|gemini-code-assist)/i) | some }}
  has_github_copilot_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*copilot/i) | some }}
  has_gitlab_duo_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*(gitlab duo|gitlab-duo)/i) | some }}
  has_gitstream_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*gitstream/i) | some }}
  has_google_jules_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*google-labs-jules/i) | some }}
  has_graphite_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*graphite/i) | some }}
  has_greptile_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*greptile/i) | some }}
  has_jazzberry_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*(^prophet$|jazzberry-ai)/i) | some }}
  has_jetbrains_junie_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*jetbrains-junie/i) | some }}
  has_korbit_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*korbit-ai/i) | some }}
  has_meticulous_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*meticulous/i) | some }}
  has_openai_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*(^codex\b|chatgpt-codex-connector)/i) | some }}
  has_opencode_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*opencode/i) | some }}
  has_qodo_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*(^pr agent|^pr-agent|^pr_agent|codium pr-agent|pr-ia-20240430|qodo\b|s-qce-pr-reviewer)/i) | some }}
  has_replit_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*replit/i) | some }}
  has_rovo_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*rovo coding agent/i) | some }}
  has_sourcegraph_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*sourcegraph/i) | some }}
  has_sourcery_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*sourcery/i) | some }}
  has_sweep_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*sweep-ai/i) | some }}
  has_tabnine_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*tabnine/i) | some }}
  has_tusk_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*use-tusk/i) | some }}
  has_whatthediff_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*what-the-diff/i) | some }}
  has_windsurf_coauthor: {{ branch.commits.messages | match(regex=r/Co-authored-by:.*(^windsurf|\bwindsurf\b)/i) | some }}

  # PR Author detection patterns
  is_claude_author: {{ pr.author | match(regex=r/(^claude$|claude ai|claude ai assistant|claude code|claude github action|claude\[bot\])/i) }}
  is_coderabbit_author: {{ pr.author | match(regex=r/coderabbit/i) }}
  is_cursor_author: {{ pr.author | match(regex=r/(-cursor|^cursor)/i) }}
  is_devin_author: {{ pr.author | match(regex=r/(devin ai|devin-ai)/i) }}
  is_fine_author: {{ pr.author | match(regex=r/(^fine-agent|^fine-ai)/i) }}
  is_gemini_author: {{ pr.author | match(regex=r/(^gemini$|^gemini-|gemini-code-assist)/i) }}
  is_github_copilot_author: {{ pr.author | match(regex=r/copilot/i) }}
  is_gitstream_author: {{ pr.author | match(regex=r/gitstream/i) }}
  is_greptile_author: {{ pr.author | match(regex=r/greptile/i) }}
  is_qodo_author: {{ pr.author | match(regex=r/(^pr agent|^pr-agent|^pr_agent|codium pr-agent|pr-ia-20240430|qodo\b|s-qce-pr-reviewer)/i) }}

automations:
  # =============================================================================
  # RULES FILE ADOPTION - Label PRs that add/modify AI tool configuration files
  # =============================================================================

  label_aider_rules:
    if:
      - {{ has_aider_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-aider'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Aider Rules File**

            This PR adds or modifies Aider configuration files, indicating rules-based AI adoption.

  label_amazonq_rules:
    if:
      - {{ has_amazonq_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-amazon-q'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Amazon Q Rules File**

            This PR adds or modifies Amazon Q configuration files, indicating rules-based AI adoption.

  label_augmentcode_rules:
    if:
      - {{ has_augmentcode_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-augmentcode'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: AugmentCode Rules File**

            This PR adds or modifies AugmentCode configuration files, indicating rules-based AI adoption.

  label_claude_rules:
    if:
      - {{ has_claude_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-claude'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Claude Rules File**

            This PR adds or modifies Claude/Claude Code configuration files, indicating rules-based AI adoption.

  label_cursor_rules:
    if:
      - {{ has_cursor_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-cursor'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Cursor Rules File**

            This PR adds or modifies Cursor configuration files, indicating rules-based AI adoption.

  label_firebase_rules:
    if:
      - {{ has_firebase_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-firebase-studio'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Firebase Studio Rules File**

            This PR adds or modifies Firebase Studio AI configuration files, indicating rules-based AI adoption.

  label_gemini_rules:
    if:
      - {{ has_gemini_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-gemini'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Google Gemini Rules File**

            This PR adds or modifies Google Gemini configuration files, indicating rules-based AI adoption.

  label_github_copilot_rules:
    if:
      - {{ has_github_copilot_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-github-copilot'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: GitHub Copilot Rules File**

            This PR adds or modifies GitHub Copilot instruction files, indicating rules-based AI adoption.

  label_goose_rules:
    if:
      - {{ has_goose_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-goose'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Goose Rules File**

            This PR adds or modifies Goose configuration files, indicating rules-based AI adoption.

  label_jetbrains_junie_rules:
    if:
      - {{ has_jetbrains_junie_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-jetbrains-junie'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: JetBrains Junie Rules File**

            This PR adds or modifies JetBrains Junie configuration files, indicating rules-based AI adoption.

  label_kilocode_rules:
    if:
      - {{ has_kilocode_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-kilocode'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Kilo Code Rules File**

            This PR adds or modifies Kilo Code configuration files, indicating rules-based AI adoption.

  label_kiro_rules:
    if:
      - {{ has_kiro_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-kiro'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Kiro Rules File**

            This PR adds or modifies Kiro steering files, indicating rules-based AI adoption.

  label_openai_rules:
    if:
      - {{ has_openai_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-openai-codex'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: OpenAI Codex Rules File**

            This PR adds or modifies OpenAI Codex configuration files, indicating rules-based AI adoption.

  label_openhands_rules:
    if:
      - {{ has_openhands_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-openhands'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Open Hands Rules File**

            This PR adds or modifies Open Hands microagent files, indicating rules-based AI adoption.

  label_warp_rules:
    if:
      - {{ has_warp_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-warp'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Warp Rules File**

            This PR adds or modifies Warp configuration files, indicating rules-based AI adoption.

  label_windsurf_rules:
    if:
      - {{ has_windsurf_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-windsurf'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Windsurf Rules File**

            This PR adds or modifies Windsurf configuration files, indicating rules-based AI adoption.

  label_zed_rules:
    if:
      - {{ has_zed_rules }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-rules'
      - action: add-label@v1
        args:
          label: 'ai-tool-zed'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Zed Rules File**

            This PR adds or modifies Zed configuration files, indicating rules-based AI adoption.

  # =============================================================================
  # CO-AUTHOR ADOPTION - Label PRs where AI tools contributed as co-authors
  # =============================================================================

  label_aider_coauthor:
    if:
      - {{ has_aider_coauthor }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-coauthor'
      - action: add-label@v1
        args:
          label: 'ai-tool-aider'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Aider Co-author**

            This PR includes commits with Aider as a co-author, indicating collaborative AI adoption.

  label_claude_coauthor:
    if:
      - {{ has_claude_coauthor }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-coauthor'
      - action: add-label@v1
        args:
          label: 'ai-tool-claude'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Claude Co-author**

            This PR includes commits with Claude as a co-author, indicating collaborative AI adoption.

  label_cursor_coauthor:
    if:
      - {{ has_cursor_coauthor }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-coauthor'
      - action: add-label@v1
        args:
          label: 'ai-tool-cursor'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Cursor Co-author**

            This PR includes commits with Cursor as a co-author, indicating collaborative AI adoption.

  label_github_copilot_coauthor:
    if:
      - {{ has_github_copilot_coauthor }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-coauthor'
      - action: add-label@v1
        args:
          label: 'ai-tool-github-copilot'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: GitHub Copilot Co-author**

            This PR includes commits with GitHub Copilot as a co-author, indicating collaborative AI adoption.

  label_gemini_coauthor:
    if:
      - {{ has_gemini_coauthor }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-coauthor'
      - action: add-label@v1
        args:
          label: 'ai-tool-gemini'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Google Gemini Co-author**

            This PR includes commits with Google Gemini as a co-author, indicating collaborative AI adoption.

  label_qodo_coauthor:
    if:
      - {{ has_qodo_coauthor }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-coauthor'
      - action: add-label@v1
        args:
          label: 'ai-tool-qodo'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Qodo Co-author**

            This PR includes commits with Qodo (formerly Codium/PR-Agent) as a co-author, indicating collaborative AI adoption.

  label_devin_coauthor:
    if:
      - {{ has_devin_coauthor }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-coauthor'
      - action: add-label@v1
        args:
          label: 'ai-tool-devin'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Devin AI Co-author**

            This PR includes commits with Devin AI as a co-author, indicating collaborative AI adoption.

  label_windsurf_coauthor:
    if:
      - {{ has_windsurf_coauthor }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-coauthor'
      - action: add-label@v1
        args:
          label: 'ai-tool-windsurf'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Windsurf Co-author**

            This PR includes commits with Windsurf as a co-author, indicating collaborative AI adoption.

  # Add more co-author automations for other tools as needed...

  # =============================================================================
  # PR AUTHOR ADOPTION - Label PRs created by AI tools/bots
  # =============================================================================

  label_claude_author:
    if:
      - {{ is_claude_author }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-pr-author'
      - action: add-label@v1
        args:
          label: 'ai-tool-claude'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Claude PR Author**

            This PR was created by Claude, indicating AI-driven PR creation.

  label_cursor_author:
    if:
      - {{ is_cursor_author }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-pr-author'
      - action: add-label@v1
        args:
          label: 'ai-tool-cursor'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Cursor PR Author**

            This PR was created by Cursor, indicating AI-driven PR creation.

  label_github_copilot_author:
    if:
      - {{ is_github_copilot_author }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-pr-author'
      - action: add-label@v1
        args:
          label: 'ai-tool-github-copilot'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: GitHub Copilot PR Author**

            This PR was created by GitHub Copilot, indicating AI-driven PR creation.

  label_devin_author:
    if:
      - {{ is_devin_author }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-pr-author'
      - action: add-label@v1
        args:
          label: 'ai-tool-devin'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Devin AI PR Author**

            This PR was created by Devin AI, indicating AI-driven PR creation.

  label_qodo_author:
    if:
      - {{ is_qodo_author }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-pr-author'
      - action: add-label@v1
        args:
          label: 'ai-tool-qodo'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: Qodo PR Author**

            This PR was created by Qodo (formerly Codium/PR-Agent), indicating AI-driven PR creation.

  label_coderabbit_author:
    if:
      - {{ is_coderabbit_author }}
    run:
      - action: add-label@v1
        args:
          label: 'ai-adoption-pr-author'
      - action: add-label@v1
        args:
          label: 'ai-tool-coderabbit'
      - action: add-comment@v1
        args:
          comment: |
             **AI Adoption Detected: CodeRabbit PR Author**

            This PR was created by CodeRabbit, indicating AI-driven PR creation.
