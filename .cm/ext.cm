# -*- mode: yaml -*-

manifest:
    version: 1.0

automations:
    estimated_time_to_review:
        if:
            - true
        run:
            -   action: add-label@v1
                args:
                    label: "{{ calc.etr }} min review"
                    color: {{'E94637' if (calc.etr >= 20) else ('FBBD10' if (calc.etr >= 5) else '36A853')}}

    safe_changes:
        if:
            - {{is.formatting or is.docs or is.tests}}
        run:
            -   action: add-label@v1
                args:
                    label: 'safe-changes'
            -   action: approve@v1

    no_tests:
        if:
            - {{is.formatting or is.docs | nope}}
            - {{files | match(regex=r/tests\//) | nope}}
        run:
            -   action: add-label@v1
                args:
                    label: 'missing-tests'
                    color: '#E94637'

calc:
    etr: {{branch | estimatedReviewTime}}
is:
    formatting: {{source.diff.files | isFormattingChange}}
    docs: {{files | allDocs}}
    tests: {{files | match(regex=r/tests\//) | every}}